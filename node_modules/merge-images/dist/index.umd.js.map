{"version":3,"file":"index.umd.js","sources":["../src/index.js"],"sourcesContent":["// Defaults\nconst defaultOptions = {\n\tformat: 'image/png',\n\tquality: 0.92,\n\twidth: undefined,\n\theight: undefined,\n\tCanvas: undefined\n};\n\n// Return Promise\nconst mergeImages = (sources = [], options = {}) => new Promise(resolve => {\n\toptions = Object.assign({}, defaultOptions, options);\n\n\t// Setup browser/Node.js specific variables\n\tconst canvas = options.Canvas ? new options.Canvas() : window.document.createElement('canvas');\n\tconst Image = options.Canvas ? options.Canvas.Image : window.Image;\n\tif (options.Canvas) {\n\t\toptions.quality *= 100;\n\t}\n\n\t// Load sources\n\tconst images = sources.map(source => new Promise((resolve, reject) => {\n\t\t// Convert sources to objects\n\t\tif (source.constructor.name !== 'Object') {\n\t\t\tsource = { src: source };\n\t\t}\n\n\t\t// Resolve source and img when loaded\n\t\tconst img = new Image();\n\t\timg.onerror = () => reject(new Error('Couldn\\'t load image'));\n\t\timg.onload = () => resolve(Object.assign({}, source, { img }));\n\t\timg.src = source.src;\n\t}));\n\n\t// Get canvas context\n\tconst ctx = canvas.getContext('2d');\n\n\t// When sources have loaded\n\tresolve(Promise.all(images)\n\t\t.then(images => {\n\t\t\t// Set canvas dimensions\n\t\t\tconst getSize = dim => options[dim] || Math.max(...images.map(image => image.img[dim]));\n\t\t\tcanvas.width = getSize('width');\n\t\t\tcanvas.height = getSize('height');\n\n\t\t\t// Draw images to canvas\n\t\t\timages.forEach(image => ctx.drawImage(image.img, image.x || 0, image.y || 0));\n\n\t\t\tif (options.Canvas && options.format === 'image/jpeg') {\n\t\t\t\t// Resolve data URI for node-canvas jpeg async\n\t\t\t\treturn new Promise(resolve => {\n\t\t\t\t\tcanvas.toDataURL(options.format, {\n\t\t\t\t\t\tquality: options.quality,\n\t\t\t\t\t\tprogressive: false\n\t\t\t\t\t}, (err, jpeg) => {\n\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\tthrow err;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tresolve(jpeg);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// Resolve all other data URIs sync\n\t\t\treturn canvas.toDataURL(options.format, options.quality);\n\t\t}));\n});\n\nexport default mergeImages;\n"],"names":["const"],"mappings":"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"}